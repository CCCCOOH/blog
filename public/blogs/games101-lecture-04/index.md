> è¿™ä¸€è®²æ˜¯å‰å‡ è®²æœ€é‡è¦æœ€éš¾çš„ä¸€è®²ã€‚

## æ—‹è½¬çŸ©é˜µæ˜¯æ­£äº¤çŸ©é˜µ

æ—‹è½¬çŸ©é˜µï¼š 

$$
R_{\theta}=
\begin{pmatrix}
\cos\theta & -\sin\theta \\
\sin\theta & \cos\theta
\end{pmatrix}
$$

æ—‹è½¬ $-\theta$ çš„çŸ©é˜µï¼š
$$
R_{-\theta}=
\begin{pmatrix}
\cos\theta & \sin\theta \\
-\sin\theta & \cos\theta
\end{pmatrix}
$$
å¯ä»¥å‘ç°ï¼Œ$R_{-\theta}$ æ°å¥½æ˜¯ $R_{\theta}$ è½¬ç½®ï¼Œå³ï¼š

$$
R_{-\theta}=R_{\theta}^{T}
$$
ä»å®šä¹‰ä¸Šæ¥çœ‹ï¼ˆby definationï¼‰$R_{-\theta}$ å’Œ $R_{\theta}^{-1}$ åˆšå¥½æ˜¯ä¸€ä¸ªäº’é€†çš„æ“ä½œã€‚æ‰€ä»¥ï¼š$R_{-\theta}=R_{\theta}^{-1}$ã€‚

> ä»æ•°å­¦ä¸Šè¯´ï¼Œè¯¥çŸ©é˜µæ˜¯ä¸€ä¸ªæ­£äº¤çŸ©é˜µï¼Œéå¸¸å¥½çš„æ€§è´¨ã€‚

## 3D Transformation ä¸‰ç»´å˜æ¢

### 3D é½æ¬¡åæ ‡


- ç‚¹ï¼š$(x,y,z,1)^{T}$
- å‘é‡ï¼š$(x,y,z,0)^{T}$

å¯¹äºä¸€ä¸ª $w\neq0$ çš„ç‚¹ï¼Œ$(x,y,z,w)$ ä¸€èˆ¬è®¤ä¸ºæ˜¯ä¸€ä¸ªç‚¹ï¼Œåªéœ€è¦åŒé™¤ä»¥ $w$ å³å¯ï¼š
$$
(x/w, y / w, z / w, 1)^{T}
$$


### 3D å˜æ¢

å¯¹äºä»¿å°„å˜æ¢ï¼š

$$
\begin{pmatrix}
x' \\
y' \\
z' \\
1
\end{pmatrix}
=
\begin{pmatrix}
a & b & c & t_{x} \\
d & e & f & t_{y} \\
g & h & i & t_{z} \\
0 & 0 & 0 & 1
\end{pmatrix}
\cdot
\begin{pmatrix}
x \\
y \\
z \\
1
\end{pmatrix}
$$
ç±»ä¼¼äºäºŒç»´ç©ºé—´ä¸­çš„å˜æ¢ã€‚


### 3D ç¼©æ”¾

$$
S(s_{x},s_{y},s_{z})=
\begin{pmatrix}
s_{x} & 0 & 0 & 0 \\
0 & s_{y} & 0 & 0 \\
0 & 0 & s_{z} & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$

### 3D å¹³ç§»

$$
T(t_{x},t_{y},t_{z})=
\begin{pmatrix}
1 & 0 & 0 & t_{x} \\
0 & 1 & 0 & t_{y} \\
0 & 0 & 1 & t_{z} \\
0 & 0 & 0 & 1
\end{pmatrix}
$$

### 3D ç»•è½´æ—‹è½¬

å¯èƒ½æ˜¯ä¸‰ç»´ç©ºé—´ä¸­æœ€å¤æ‚çš„æ“ä½œã€‚

$$
R_{x}(\alpha)
=
\begin{pmatrix}
1 & 0 & 0 & 0 \\
0 & \cos\alpha & -\sin\alpha & 0 \\
0 & \sin\alpha & \cos\alpha & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$
$$
R_{y}(\alpha)
=
\begin{pmatrix}
\cos\alpha & 0 & \sin\alpha & 0 \\
0 & 1 & 0 & 0 &  \\
-\sin\alpha & 0 & \cos\alpha & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$

$$
R_{z}(\alpha)=\begin{pmatrix}
\cos\alpha & -\sin\alpha & 0 & 0 \\
\sin\alpha & \cos\alpha & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182023094.png)

ä¸€ä¸ªæœ‰è¶£çš„è§„å¾‹ï¼Œç»•å¯¹åº”çš„è½´æ—‹è½¬ï¼Œå¯¹åº”è¡Œä¸æ”¹å˜ã€‚æ¯”å¦‚ç»• $y$ è½´æ—‹è½¬ï¼Œç¬¬äºŒè¡Œæ˜¯ä¸å˜çš„ã€‚

é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿™é‡Œçš„ $y$ è½´æ—‹è½¬çŸ©é˜µå½¢å¼ä¸å¤ªä¸€æ ·ï¼Ÿ

å¦‚æœç»™ä½  $x \times y$ è½´ï¼Œé€šè¿‡å³æ‰‹èºæ—‹å®šåˆ™å¯ä»¥å¾—åˆ° $z$ è½´ã€‚åŒæ ·çš„ï¼Œç”¨ $y \times z$ ä¹Ÿå¯ä»¥å¾—åˆ° $x$ è½´ï¼Œç§°ä¹‹ä¸º `å¾ªç¯å¯¹ç§°` æ€§è´¨ã€‚ä½†æ˜¯ç”¨ $x \times z$ å¾—åˆ°çš„æ˜¯ $-y$ï¼Œç”¨ $z\times x$ æ‰èƒ½å¾—åˆ° $y$ã€‚

> ä»»ä½•å¤æ‚æ—‹è½¬éƒ½å¯ä»¥åˆ†è§£ä¸ºç»•è½´æ—‹è½¬çš„ç»„åˆã€‚

### ç½—å¾·é‡Œæ ¼æ–¯ï¼ˆRodriguesï¼‰æ—‹è½¬å…¬å¼

- æ—‹è½¬è½´ $n$
- æ—‹è½¬è§’åº¦ $\alpha$

$$
R(n, \alpha) = \cos(\alpha)I + (1-\cos(\alpha))nn^{T}+\sin(\alpha)\begin{pmatrix}
0 & -n_{z} & n_{y} \\
n_{z} & 0 & -n_{x} \\
-n_{y} & n_{x} & 0
\end{pmatrix}
$$
![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182043650.png)

## Viewing å˜æ¢

- Viewï¼ˆè§†å›¾ï¼‰/Camera å˜æ¢
- Projectionï¼ˆæŠ•å½±ï¼‰å˜æ¢
	- ï¼ˆOrthographicï¼‰æ­£äº¤æŠ•å½±
	- ï¼ˆPerspectiveï¼‰é€è§†æŠ•å½±


æˆ‘ä»¬å­¦äº†è¿™ä¹ˆå¤šçš„å˜æ¢ï¼Œæœ€ç»ˆéƒ½æ˜¯ä¸ºäº†æŠŠä¸‰ç»´ç©ºé—´ä¸­çš„ç‰©ä½“å˜æˆäºŒç»´ç©ºé—´ä¸­çš„ä¸€å¼ ç…§ç‰‡ï¼ˆæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼‰ã€‚


### View/Camera å˜æ¢

### å¼•æ–‡

- ä»€ä¹ˆæ˜¯ `view transformation` ï¼Ÿ
- æ€è€ƒå¦‚ä½•æ‹ä¸€å¼ ç…§ç‰‡ï¼š
	- æ‰¾ä¸€ä¸ªå¥½çš„åœºæ™¯ã€å®‰æ’å¥½æ¼”å‘˜ï¼ˆ**model** Transformation æ¨¡å‹å˜æ¢ï¼‰
	- æ‰¾ä¸€ä¸ªå¥½çš„â€œè§’åº¦â€æ”¾ç½®æ‘„åƒæœºï¼ˆ**view** Transformation è§†å›¾å˜æ¢ï¼‰
	- èŒ„å­ï¼

ç®€ç§° `MVP` å˜æ¢ï¼

- å¦‚ä½•å®æ–½è§†å›¾å˜æ¢ `view transformation`ï¼Ÿ
- å›å¿†ï¼šæˆ‘ä»¬å…ˆè¦æ‘†å¥½ç›¸æœºã€‚
	- `Positoin`: $\vec{e}$ï¼ˆä½ç½®ï¼‰
	- `Look-at/graze direction`ï¼š$\hat{g}$ï¼ˆæœå‘ï¼‰
	- `Up direction`ï¼š$\hat{t}$ï¼ˆå¤´é¡¶æ–¹å‘ï¼‰

ç›¸å¯¹è¿åŠ¨äºè§‚å¯Ÿä¸Šï¼ˆæ‹ç…§ï¼‰ä¹Ÿæ˜¯åŒç†ã€‚

- å½“ç›¸æœºå’Œæ‰€æœ‰çš„ç‰©ä½“ä¸€èµ·ç§»åŠ¨æ—¶ï¼Œæ‹å‡ºçš„ç…§ç‰‡ä¸€æ ·ã€‚

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182106450.png)

- ä¸ºä»€ä¹ˆä¸è€ƒè™‘æŠŠç›¸æœºæ°¸è¿œç½®äºæºç‚¹ï¼Œä¸Šæ–¹åŒ $Y$ è½´ï¼Œå¹¶ä¸” look at $-Z$ã€‚
- å¹¶ä¸”è®©ç›¸æœºåŒæ‰€æœ‰ç‰©ä½“ä¸€åŒç§»åŠ¨ã€‚

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182108196.png)

### æ€ä¹ˆå†™å‡ºæ•°å­¦è¡¨ç¤º

é€šè¿‡ $V_{view}$ å˜æ¢ç›¸æœºï¼Œåœ¨æ•°å­¦ä¸Šæ€ä¹ˆè¡¨ç¤ºï¼Ÿ
- å°† $e$ å¹³ç§»åˆ°é›¶ç‚¹
- æ—‹è½¬ $g$ åˆ° $-Z$
- æ—‹è½¬ $t$ åˆ° $Y$
- æ—‹è½¬ $(gxt)$ åˆ° $X$

> ä½†æ˜¯å­©å­ï¼Œè¿™å¹¶ä¸å¥½å†™ã€‚


![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182129003.png)


æˆ‘ä»¬å¯ä»¥åˆ†è§£ä¸º `å¹³ç§»+æ—‹è½¬` ä¸¤æ­¥ã€‚

$$
M_{view}=R_{view}T_{view}
$$
å…ˆå°†ç›¸æœºå¹³ç§»åˆ°åŸç‚¹ï¼š
$$
T_{view}=\begin{bmatrix}
1 & 0 & 0 & -x_{e} \\
0 & 1 & 0 & -y_{e} \\
0 & 0 & 1 & -z_{e} \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

è¿™é‡Œçš„ $(x_{e},y_{e},z_{e},1)$ æ˜¯ç›¸æœºçš„åæ ‡ã€‚

æ¥ä¸‹æ¥è€ƒè™‘å¦‚ä½•æ—‹è½¬æ‘„åƒæœºï¼Œä½¿å…¶åŒ¹é…æˆ‘ä»¬çš„åŸºå‡†è½´ã€‚

- æ—‹è½¬ $g$ åˆ° $-Z$
- æ—‹è½¬ $t$ åˆ° $Y$
- æ—‹è½¬ $(gxt)$ åˆ° $X$

> $(gxt)$ å®é™…ä¸Šæ˜¯å…¶ä»–ä¸¤æ¡è½´çš„å‰ä¹˜ã€‚

ğŸ¤”**å°å·§æ€**ï¼šå°†ç›¸æœºæ—‹è½¬åˆ°åŸºåº•ä¸Šä¸å¥½å†™ï¼Œä½†æ˜¯åè¿‡æ¥æƒ³å¾ˆå®¹æ˜“ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªä½äºåŸç‚¹çš„ç‚¹æ—‹è½¬åˆ°ç›¸æœºå½“å‰æ‰€å¤„çš„è§’åº¦ã€‚

**æ ‡å‡†çŠ¶æ€**ä¸‹ï¼š
- $X$ è½´æ˜¯ $(1,0,0)$
- $Y$ è½´æ˜¯ $(0,1,0)$
- $Z$ è½´æ˜¯ $(0,0,1)$

**ç›®æ ‡çŠ¶æ€**ä¸‹ï¼š
- $X$ è½´å˜æˆ $\hat{g}\times \hat{t}$
- $Y$ è½´å˜æˆ $\hat{t}$
- $Z$ è½´å˜æˆ $-\hat{g}$

> å°†åæ ‡è½´çœ‹åšä¸ºå‘é‡å³å¯ï¼Œç›¸æœºçš„ä¸‰ä¸ªè½´ä¹Ÿæ˜¯å‘é‡ã€‚

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182129003.png)

### è§†å›¾å˜æ¢çŸ©é˜µ


$$
R^{-1}_{view}=
\begin{bmatrix}
x_{\hat{g}\times\hat{t}} & x_{t} & x_{-g} & 0 \\
y_{\hat{g}\times\hat{t}} & y_{t} & y_{-g} & 0 \\
z_{\hat{g}\times\hat{t}} & z_{t} & z_{-g} & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$
å¯ä»¥éªŒè¯ï¼Œå¯¹åŸç‚¹æ–½åŠ  $R_{view}^{-1}$ å¾—åˆ°ï¼š
$$
\begin{pmatrix}
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 &  \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
\begin{pmatrix}
x_{\hat{g}\times\hat{t}} & x_{t} & x_{-g} & 0 \\
y_{\hat{g}\times\hat{t}} & y_{t} & y_{-g} & 0 \\
z_{\hat{g}\times\hat{t}} & z_{t} & z_{-g} & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
=E \cdot \begin{pmatrix}
x_{\hat{g}\times\hat{t}} & x_{t} & x_{-g} & 0 \\
y_{\hat{g}\times\hat{t}} & y_{t} & y_{-g} & 0 \\
z_{\hat{g}\times\hat{t}} & z_{t} & z_{-g} & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$

è¿™é‡Œçš„ $R_{view}^{-1}$ ä¸­çš„æ¯ä¸€ä¸ªåˆ—å‘é‡å°±æ˜¯ç›¸æœºçš„è½´å‘é‡ã€‚

> $\hat{g}\times \hat{t}=\hat{e}$


è½¬ç½®åå¾—åˆ°ï¼š
$$
R_{view}=
\begin{bmatrix}
x_{\hat{g}\times \hat{t}} & y_{\hat{g}\times \hat{t}} & z_{\hat{g}\times \hat{t}} & 0 \\
x_{t} & y_{t} & z_{t} & 0 \\
x_{-g} & y_{-g} & z_{-g} & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

> å¯ä»¥çœ‹åˆ°ï¼Œ$R_{view}$ å…¶å®å°±æ˜¯æŠŠç›¸æœºèº«ä¸Šçš„ä¸‰æ¡æ­£äº¤å‘é‡æ‹¼åœ¨ä¸€ä¸ªçŸ©é˜µé‡Œåšè½¬ç½®å¾—åˆ°çš„ã€‚

æ€»ç»“ï¼š
- è®©ç‰©ä½“å’Œç›¸æœºä¸€èµ·å˜æ¢ã€‚
- ç›´åˆ°ç›¸æœºä½äºåŸç‚¹ï¼Œå¤´æœä¸Šï¼ˆ$Y$ï¼‰ï¼Œçœ‹å‘ $-Z$ã€‚

è§†å›¾å˜æ¢æ“ä½œçš„æ˜¯ç›¸æœºå…¶ä»–çš„ç‰©ä½“è·Ÿç€å˜æ¢ï¼Œæˆ‘ä»¬åˆšæ‰æåˆ°äº†ç›¸å¯¹è¿åŠ¨çš„æ¦‚å¿µã€‚æˆ‘ä»¬ç§»åŠ¨å®Œè¿™äº›ç‰©ä½“ä¹‹åï¼ŒåˆæŠŠè¿™äº›ç‰©ä½“æŒ‰ç…§è§†å›¾å˜æ¢çš„çŸ©é˜µåšäº†ä¸€æ¬¡å˜æ¢ï¼ˆå› ä¸ºä»–è¦å’Œç›¸æœºä¸€å—å„¿å˜æ¢ï¼‰ã€‚æ‰€ä»¥å¯ä»¥å‘ç°ï¼Œä¸ç®¡æ˜¯æ¨¡å‹çŸ©é˜µè¿˜æ˜¯è§†å›¾çŸ©é˜µï¼Œæœ€åéƒ½ä¼šè¢«åº”ç”¨åˆ°ç‰©ä½“ä¸Šã€‚æ‰€ä»¥è¯´è¿™ä¸¤ä¸ªçŸ©é˜µæœ¬è´¨ä¸Šåšçš„äº‹æƒ…å·®ä¸å¤šï¼ˆä¸€ä¸ªæ„æ€ï¼‰ï¼Œæ‰€ä»¥è¿™ä¿©ç»å¸¸è¢«æ”¾åœ¨ä¸€èµ·è¢«å¤§å®¶ç§°ä½œ**æ¨¡å‹è§†å›¾å˜æ¢**ã€‚

æ¥ä¸‹æ¥å°±è¦åšæŠ•å½±æ“ä½œï¼š`Projection`ã€‚å½“äººå·²ç»ç«™å¥½ï¼Œç›¸æœºå·²ç»æ‘†å¥½ï¼Œä¸‹é¢å°±éœ€è¦å°†ä¸‰ç»´æŠ•å½±åˆ°äºŒç»´ã€‚

æ¨¡å‹å˜æ¢è¯´çš„æ˜¯é€šè¿‡å˜æ¢æŠŠç‰©ä½“æ‘†åœ¨åœºæ™¯é‡Œã€‚

## æŠ•å½±å˜æ¢

### é“ç†æˆ‘éƒ½æ‡‚ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆé¸½å­è¿™ä¹ˆå¤§ï¼Ÿ

è®¡ç®—æœºä¸­çš„æŠ•å½±ï¼š
- `3D` to `2D`
- **æ­£äº¤æŠ•å½±**ï¼šæ­£æ–¹ä½“çš„æ‰€æœ‰æ£±å¹³è¡Œã€‚
- **é€è§†æŠ•å½±**ï¼šå»¶é•¿æ£±ä¼šç›¸äº¤äºä¸€ä¸ªç‚¹ä¸Šï¼ˆäººçœ¼çš„æˆåƒï¼‰ã€‚

> Tiger Book è¿™æœ¬ä¹¦ä¸­çš„ä¾‹å­ï¼ˆå¹¶ä¸ç›´è§‚ï¼‰ã€‚

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182221046.png)


> **é“ç†æˆ‘éƒ½æ‡‚ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆé¸½å­ğŸ•Šè¿™ä¹ˆå¤§ï¼Ÿ**

ç”±æ¢—æ¨æµ‹é—«è€å¸ˆçš„å¹´é¾„ï¼š[https://www.bilibili.com/video/BV16B4y1r7tn/](https://www.bilibili.com/video/BV16B4y1r7tn/)ã€‚

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182226235.png)


**ps**ï¼šè¿™æ˜¯æœ¬è¯¾ç¨‹æœ€å¥½ç©çš„æ¢—ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚

é€è§†æŠ•å½±å¯¹æ¯”æ­£äº¤æŠ•å½±ï¼š

**![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182228063.png)

## æ­£äº¤æŠ•å½±

ä¸€ç§ç®€å•çš„ç†è§£æ–¹å¼ï¼š

- é¦–å…ˆæŠŠç›¸æœºæ”¾åœ¨åŸç‚¹ï¼Œçœ‹å‘ $-Z$ï¼Œå‘ä¸Šæ˜¯ $Y$ã€‚
- ä¸¢æ‰ $Z$ åæ ‡è‡ªç„¶æ˜¯å¹³é¢ä¸Šçš„ä¸€å¼ å›¾ã€‚
- æ— è®º $x$ å’Œ $y$ å¤šå¤§ï¼Œéƒ½ç§»åŠ¨åˆ° $[-1,1]^{2}$ è¿™ä¸ªçŸ©å½¢å†…ã€‚

> æœ‰åŒå­¦å¯èƒ½é—®ï¼Œå¦‚æœæŠŠ $Z$ æ‰”æ‰å¦‚ä½•åŒºåˆ†å‰åå‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨åé¢çš„è¯¾ç¨‹ä¼šå¾—åˆ°è®¨è®ºã€‚

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182231260.png)

ä½†æ˜¯æ›´åŠ æ­£å¼çš„åšæ³•ï¼ˆåœ¨å›¾å½¢å­¦ä¸Šæ¥è¯´æ›´åŠ æ–¹ä¾¿çš„åšæ³•ï¼‰æ˜¯ï¼š
- æˆ‘ä»¬å®šä¹‰ç©ºé—´ä¸­çš„ä¸€ä¸ªç«‹æ–¹ä½“ï¼š$[l,r]\times[b,t]\times[f,n]$ï¼ˆå·¦å³ã€ä¸‹ä¸Šã€**è¿œè¿‘**ï¼‰
- æˆ‘ä»¬è¯•å›¾æŠŠè¿™ä¸ªç«‹æ–¹ä½“æ˜ å°„åˆ°ï¼š**ç«‹æ–¹ä½“**$[-1,1]^{3}$ï¼ˆæ­£åˆ™/è§„èŒƒ/æ ‡å‡†ç«‹æ–¹ä½“ `canonical cube`ï¼‰

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182234878.png)

æ–¹æ³•æ˜¯ï¼š
- å…ˆæŠŠç«‹æ–¹ä½“çš„ä¸­å¿ƒç§»åˆ°åŸç‚¹ã€‚
- ç„¶åå°† $x,y,z$ è½´~~é¸½å­~~**å„è‡ª**ä¼¸ç¼©åˆ° $[-1,1]$

å®šä¹‰ï¼š
- æˆ‘ä»¬åœ¨ $x$ è½´ä¸Šå®šä¹‰å·¦ã€å³ã€‚
- åœ¨ $y$ è½´ä¸Šå®šä¹‰ä¸‹ã€ä¸Šã€‚
- åœ¨ $z$ è½´ä¸Šå®šä¹‰è¿œã€è¿‘ã€‚

*ä¸€ä¸ªä¸ç›´è§‚çš„å®šä¹‰*ï¼š $z$ **çš„æ­£æ–¹å‘ä¸ºè¿‘ï¼Œè´Ÿæ–¹å‘ä¸ºè¿œ**ã€‚æ‰€ä»¥ä¸€ä¸ªç‰©ä½“ç¦»æˆ‘ä»¬æ›´è¿‘æ„å‘³ç€å®ƒçš„ $z$ å€¼è¦æ›´å¤§ã€‚

> **åŸå› **ï¼šæˆ‘ä»¬æ˜¯æ²¿ç€ $-z$ æ–¹å‘å»çœ‹çš„ï¼ˆä¸ºäº†ä¿è¯å³æ‰‹åæ ‡ç³»ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸€äº›å›¾å½¢å­¦çš„ API é‡Œï¼ˆæ¯”å¦‚ OpenGLï¼‰ä¼šå‡è®¾æˆ‘ä»¬ç”¨çš„æ˜¯å·¦æ‰‹ç³»ï¼Œå› ä¸ºå·¦æ‰‹ç³»åœ¨è¿™ä¸€ç‚¹ä¸Šä¼šæ›´æ–¹ä¾¿ä¸€äº›ã€‚


### æ•°å­¦è¡¨è¾¾å¼

- **ä¸­å¿ƒç§»åˆ°åŸç‚¹**ã€‚
- **ç¼©æ”¾**ã€‚

$$
M_{ortho}=\begin{bmatrix}
\frac{2}{r-l} & 0 & 0 & 0 \\
0 & \frac{2}{t-b} & 0 & 0 \\
0 & 0 & \frac{2}{n-f} & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
1 & 0 & 0 & - \frac{r+l}{2} \\
0 & 1 & 0 & -\frac{t+b}{2} \\
0 & 0 & 1 & -\frac{n+f}{2} \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182234878.png)

> å› ä¸ºè¦†ç›–çš„èŒƒå›´æ˜¯ $[l,r]\to[-1,1]$ï¼Œæ‰€ä»¥ç¼©æ”¾çš„é•¿åº¦ä¸º $2$ã€‚

å¯¹äºæ­£äº¤æŠ•å½±ï¼Œéå¸¸ç®€å•å°±å†™å‡ºæ¥äº†ã€‚

## é€è§†æŠ•å½±

- é€è§†æŠ•å½±æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„æŠ•å½±ã€‚
- è¿‘å¤§è¿œå°ã€‚
- å¹³è¡Œçº¿çœ‹ä¸Šå»ä¸å†å¹³è¡Œã€‚

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182248445.png)

### é½æ¬¡å®šä¹‰

- å¯¹ä¸€ä¸ªåæ ‡ $(x,y,z,1)$ï¼Œ$(kx,ky,kz,k)$ï¼Œåªè¦ $k\neq 0$ å°±è¡¨ç¤ºåŒä¸€ä¸ªä¸‰ç»´ç©ºé—´ä¸­åŒä¸€ä¸ªç‚¹ $(x,y,z)$ã€‚
- æ¯”å¦‚ $(1,0,0,1)$ å’Œ $(2,0,0,2)$ éƒ½è¡¨ç¤º $(1,0,0,1)$ã€‚
- æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬åŒä¹˜ä»¥ $z$ï¼Œ$(xz,yz,z^{2},z)$ ä¹Ÿè¡¨ç¤ºåŒä¸€ä¸ªç‚¹ $(x,y,z,1)$ã€‚

> ç®€å•ä½†æœ‰ç”¨ã€‚

### å¦‚æœåšé€è§†æŠ•å½±

å¦‚ä½•åšé€è§†æŠ•å½±ï¼š

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182252602.png)


å¾ˆå¤šæ•™æä¼šç›´æ¥æŠŠé€è§†æŠ•å½±çš„çŸ©é˜µç»™å‡ºæ¥ï¼Œä½†æ˜¯è¿™æ ·ä¸å¥½ç†è§£ã€‚æ›´å¥½ç†è§£çš„æ–¹å¼æ˜¯æƒ³è±¡åŸå±å¹•ä¸Šçš„**å››ä¸ªé¡¶ç‚¹**ï¼Œæˆ‘ä»¬æŠŠä»–ä»¬æŒ¤åˆ°å’Œè¿‘å¹³é¢åŒä¸€ä¸ªé«˜åº¦ä¸Šã€‚æ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬æŠŠä»–â€œæŒ¤â€æˆäº†ç©ºé—´ä¸­çš„ä¸€ä¸ªé•¿æ–¹ä½“ã€‚ç„¶ååšæ­£äº¤æŠ•å½±å°±è¡Œäº†ã€‚

ç°åœ¨çš„é—®é¢˜æ˜¯ï¼šâ€œæŒ¤â€è¿™ä¸ªæ“ä½œæ€ä¹ˆåšï¼Ÿ

åœ¨æŒ¤å‹çš„æ“ä½œä¸­æˆ‘ä»¬è§„å®šå‡ ç‚¹ï¼š
- è¿‘å¹³é¢ä¸Šçš„ç‚¹æ°¸è¿œä¸å˜ï¼ˆæƒ³è±¡ä½ è¦æŠŠçª—æˆ·å¤–é¢çš„ä¸œè¥¿ç”»åˆ°çª—æˆ·ä¸Šï¼Œçª—æˆ·ä¸Šçš„ä¸œè¥¿ä¸ä¼šæ”¹å˜ï¼‰ã€‚
- è¿œå¹³é¢çš„ç‚¹ $z$ å€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚
- è¿œå¹³é¢çš„ä¸­å¿ƒç‚¹ä¸ä¼šå˜ã€‚

ç°åœ¨çš„é—®é¢˜æ˜¯å¦‚ä½•æŠŠ `Frustum` æŒ¤å‹åˆ° `Cuboid`ã€‚


ä»ä¾§é¢çœ‹ï¼š

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602182318284.png)

æ ¹æ®ç›¸ä¼¼ä¸‰è§’å½¢ï¼Œä»»æ„ä¸€ä¸ªç‚¹çš„ $y$ å’Œ $x$ ä¼šå¦‚ä½•è¢«æŒ¤å‹æ˜¯ç›¸å¯¹æ¸…æ¥šçš„ã€‚è¿™å°±å¯ä»¥åšä¸ºä¸€ä¸ªå¯¹åº”å…³ç³»ã€‚

ä¹Ÿå°±æ˜¯ï¼š
$$
\begin{align}
y' = \frac{n}{z}y \\
x'=\frac{n}{z}x
\end{align}
$$
åŸæœ¬çš„åæ ‡ä¼šå˜æˆï¼ˆç¬¬äºŒæ­¥åŒä¹˜ä»¥ $z$ï¼‰ï¼š
$$
\begin{pmatrix}
x \\
y \\
z \\
1
\end{pmatrix}
\implies
\begin{pmatrix}
\frac{nx}{z} \\
\frac{ny}{z} \\
\text{unknown} \\
1
\end{pmatrix}
=\begin{pmatrix}
nx \\
ny \\
\text{still unknown}\\
z
\end{pmatrix}
$$

è¿™æ ·æˆ‘ä»¬å°±èƒ½å¡«ä¸Šå˜æ¢çŸ©é˜µçš„ä¸€éƒ¨åˆ†å€¼ã€‚

æ‰€ä»¥ä»é€è§†çŸ©é˜µåˆ°æ­£äº¤çŸ©é˜µçš„æŠ•å½±ï¼š
$$
M_{persp\to ortho}\begin{pmatrix}
x \\
y \\
z \\
1
\end{pmatrix}
=\begin{pmatrix}
nx \\
ny \\
unknown \\
z
\end{pmatrix}
$$

æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€éƒ¨åˆ†çš„ $M_{persp\to ortho}$ï¼š
$$
M_{persp\to ortho}=\begin{pmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
? & ? & ? & ? \\
0 & 0 & 1 & 0
\end{pmatrix}
$$
æˆ‘ä»¬å†åˆ©ç”¨ä¸‹é¢ä¸¤æ¡æ€§è´¨å°±å¯ä»¥å¾—åˆ°æœªçŸ¥çš„éƒ¨åˆ†ï¼š
- è¿‘å¹³é¢ä¸Šçš„ç‚¹ä¸å˜ã€‚
- è¿œå¹³é¢ä¸­å¿ƒç‚¹ä¸å˜ã€‚

ç”¨æ•°å­¦è¯­è¨€æè¿°å°±æ˜¯ï¼Œ
- å½“ $z=n$ ï¼Œå³ $(x,y,n,1)^{T}$ æ—¶ç»è¿‡ $M_{persp\to ortho}$ å˜æ¢ä¸å˜ã€‚
- å½“ $(0,0,f,1)^{T}$ ç»è¿‡å˜æ¢ä¸å˜ã€‚

æˆ‘ä»¬ä¸éš¾å†™å‡ºï¼š

$$
\begin{pmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
? & ? & ? & ? \\
0 & 0 & 1 & 0
\end{pmatrix}\begin{pmatrix}
x \\
y \\
n \\
1
\end{pmatrix}=
\begin{pmatrix}
nx + 0 + 0 + 0 \\
0 + ny + 0 + 0 \\
n? + n? + n? + n? \\
0 + 0 + n + 0
\end{pmatrix}
=
\begin{pmatrix}
nx \\
ny \\
n^{2} \\
n
\end{pmatrix}
$$

å•ç‹¬æ‹¿å‡ºç¬¬ä¸‰è¡Œæ¥çœ‹ï¼ˆè®°æœ€åä¸¤ä¸ªé—®å·ä¸º $A$ å’Œ $B$ï¼‰ï¼š
$$
\begin{pmatrix}
? & ? & A & B
\end{pmatrix}
\begin{pmatrix}
x \\
y \\
n \\
1
\end{pmatrix}
=n^{2}
$$
ç”±äºç»“æœä¸­ä¸å¸¦æœ‰ $x$ å’Œ $y$ ï¼Œå‰ä¸¤ä¸ª $?$ å°±èƒ½ç¡®å®šæ˜¯ $0$ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼š
$$
M_{persp\to ortho}=
\begin{pmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
0 & 0 & A & B \\
0 & 0 & 0 & 1
\end{pmatrix}
$$

æˆ‘ä»¬å°†æœ€åä¸¤ä½é—®å·åˆ†åˆ«è®°ä¸º $A$ å’Œ $B$ã€‚
æ ¹æ®ä¸¤æ¡æ€§è´¨åˆ†åˆ«æœ‰ï¼š

$$
\begin{pmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
0 & 0 & A & B \\
0 & 0 & 1 & 0
\end{pmatrix}\begin{pmatrix}
x \\
y \\
n \\
1
\end{pmatrix}
=
\begin{pmatrix}
nx \\
ny \\
An+B \\
n
\end{pmatrix}
=
\begin{pmatrix}
nx \\
ny \\
n^{2} \\
n
\end{pmatrix}
$$

$$
\begin{pmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
0 & 0 & A & B \\
0 & 0 & 1 & 0
\end{pmatrix}\begin{pmatrix}
0 \\
0 \\
f \\
1
\end{pmatrix}
=
\begin{pmatrix}
0 \\
0 \\
Af+B \\
f
\end{pmatrix}
=\begin{pmatrix}
0 \\
0 \\
f \\
1
\end{pmatrix}
=\begin{pmatrix}
0 \\
0 \\
f^{2} \\
f
\end{pmatrix}
$$
æ‰€ä»¥å¾—åˆ°ä¸¤ä¸ªå…³ç³»å¼ï¼š

$$
\begin{cases}
An+B=n^{2} \\
Af+B=f^{2}
\end{cases}
$$
è§£å‡ºï¼š

$$
\begin{cases}
A=n+f \\
B=-nf
\end{cases}
$$

### é€è§†æŠ•å½±æ•°å­¦è¡¨ç¤º

è‡³æ­¤ï¼Œæˆ‘ä»¬å°±ç»ˆäºæŠŠè¿™ä¸ªçŸ©é˜µç»™å¡«å®Œäº†ï¼š


$$
M_{persp\to ortho}=
\begin{pmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
0 & 0 & n+f & -nf \\
0 & 0 & 1 & 0
\end{pmatrix}
$$
å½“ç„¶ï¼Œåˆ«å¿˜è®°æˆ‘ä»¬çš„é€è§†æŠ•å½±å®Œæ•´åœ°å†™å‡ºæ¥æ˜¯è¿™æ ·çš„ï¼š

$$
M_{persp}=M_{ortho}M_{persp\to ortho}
$$
æ•´ç†ä¸€ä¸‹å°±æ˜¯ï¼š

$$
M_{persp}=
\begin{bmatrix}
\frac{2}{r-l} & 0 & 0 & 0 \\
0 & \frac{2}{t-b} & 0 & 0 \\
0 & 0 & \frac{2}{n-f} & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
1 & 0 & 0 & - \frac{r+l}{2} \\
0 & 1 & 0 & -\frac{t+b}{2} \\
0 & 0 & 1 & -\frac{n+f}{2} \\
0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
0 & 0 & n+f & -nf \\
0 & 0 & 1 & 0
\end{bmatrix}
$$

> å®Œæ•´åœ°æ¨å‡ºè¿™ä¸ªå…¬å¼çœŸçš„å¾ˆä»¤äººæ¿€åŠ¨ã€‚

### æœ€åçš„é—®é¢˜

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602190002511.png)

å¯¹äº**ä¸­é—´**($z=\frac{n+f}{2}$)ä»»ä½•ä¸€ä¸ªç‚¹ï¼Œç»è¿‡æŒ¤å‹çš„å˜æ¢åä»–çš„ $z$ ä¼šå˜å°è¿˜æ˜¯å˜å¤§è¿˜æ˜¯ä¸å˜ï¼Ÿï¼ˆæ›´ç›´è§‚åœ°é—®è¿™ä¸ªç‚¹æ˜¯è¢«æ¨å‘äº†è¿‘å¹³é¢è¿˜æ˜¯è¿œå¹³é¢ï¼‰

æˆ‘ä»¬å·²ç»çŸ¥é“äº†æŒ¤å‹çš„çŸ©é˜µï¼Œåªéœ€è¦æŠŠä¸­é—´çš„ç‚¹ä»£å…¥ç®—ä¸€ä¸‹å°±å¥½äº†ï¼š

$$
\begin{pmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
0 & 0 & n+f & -nf \\
0 & 0 & 1 & 0
\end{pmatrix}
\begin{pmatrix}
x \\
y \\
\frac{n+f}{2} \\
1
\end{pmatrix}
=
\begin{pmatrix}
nx \\
ny \\
\frac{(n+f)^{2}}{2}-nf\\
\frac{n+f}{2}
\end{pmatrix}=
\begin{pmatrix}
nx \\
ny \\
\frac{n^{2}+f^{2}+2nf}{2}-\frac{2nf}{2} \\
\frac{n+f}{2}
\end{pmatrix}
=\begin{pmatrix}
nx \\
ny \\
\frac{n^{2}+f^{2}}{2} \\
\frac{n+f}{2}
\end{pmatrix}
$$
ç„¶åè§„èŒƒåŒ–æˆ‘ä»¬å¾—åˆ°çš„æŒ¤å‹åçš„é½æ¬¡åæ ‡ï¼š

$$
\begin{pmatrix}
nx \\
ny \\
\frac{n^{2}+f^{2}}{2} \\
\frac{n+f}{2}
\end{pmatrix}
=
\begin{pmatrix}
\frac{2nx}{n+f} \\
\frac{2ny}{n+f} \\
\frac{n^{2}+f^{2}}{n+f} \\
1
\end{pmatrix}
$$
æˆ‘ä»¬è®°æ–°å¾—åˆ°çš„ $z$ åæ ‡ä¸º $z'$ï¼ŒåŸæ¥çš„ $z$ åæ ‡ä¸º $z$ ã€‚ä¸ºäº†æ¯”è¾ƒ $z'$ å’Œ $z$ çš„å…³ç³»ï¼Œæˆ‘ä»¬ä½œå·®ï¼š


$$
\begin{aligned}
z-z'&=\frac{n^{2}+f^{2}}{n+f}-\frac{n+f}{2} \\
&=\frac{2(n^{2}+f^{2})-(n+f)^{2}}{2(n+f)} \\
&=\frac{n^{2}+f^{2}-2nf}{2(n+F)} \\
&=\frac{(n-f)^{2}}{2(n+f)} \leq 0 \\
\end{aligned}
$$

ç”±åˆ†æ¯å†³å®šæ­£è´Ÿï¼Œç”±äº $(n-f)^{2}$ æ°¸è¿œå¤§äºç­‰äºé›¶ä½†**åˆ†æ¯**åœ¨å›¾ä¸­çš„ $-z$ ä¸Šæ˜¯ä¿æŒå°äºé›¶çš„ï¼Œæ‰€ä»¥ $z'-z\leq 0$ï¼Œå³ $z' \leq z$ã€‚æ‰€ä»¥å˜æ¢åçš„ $z$ åªä¼šå˜å°ï¼Œåˆå› ä¸º $z$ è¶Šå¤§è¶Šè¿‘ï¼Œè¶Šå°è¶Šè¿œï¼Œæ‰€ä»¥è¢«æ¨å‘äº†è¿œå¹³é¢ï¼ˆå‡è®¾ç›¸æœºåœ¨å¹³è¡Œçº¿ç„¦ç‚¹å¤„ï¼ŒFrustum åœ¨ $-z$ ä¸Šï¼Œä¹Ÿå°±æ˜¯ $z$ çš„è´ŸåŠè½´ï¼‰ã€‚

![image.png](https://ccccooh.oss-cn-hangzhou.aliyuncs.com/img/202602190002511.png)
